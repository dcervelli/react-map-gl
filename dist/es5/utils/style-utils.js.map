{"version":3,"sources":["../../../src/utils/style-utils.js"],"names":["getInteractiveLayerIds","style","toJS","Array","isArray","layers","filter","l","interactive","map","id","normalizeStyle","layerIndex","reduce","accum","current","Object","assign","layer","layerRef","ref","type","undefined","source","minzoom","maxzoom","layout"],"mappings":"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","sourcesContent":["\n// TODO - remove in the next major release\n// Mapbox dropped the `interactive` property: https://github.com/mapbox/mapbox-gl-js/issues/1479\nexport function getInteractiveLayerIds(style) {\n  if (!style) {\n    return null;\n  }\n  if (typeof style === 'string') {\n    return null;\n  }\n  if (style.toJS) {\n    style = style.toJS();\n  }\n\n  if (Array.isArray(style.layers)) {\n    return style.layers.filter(l => l.interactive).map(l => l.id);\n  }\n\n  return null;\n}\n\n// Prepare a map style object for diffing\n// If immutable - convert to plain object\n// Work around some issues in the styles that would fail Mapbox's diffing\nexport function normalizeStyle(style) {\n  if (!style) {\n    return null;\n  }\n  if (typeof style === 'string') {\n    return style;\n  }\n  if (style.toJS) {\n    style = style.toJS();\n  }\n  const layerIndex = style.layers.reduce(\n    (accum, current) => Object.assign(accum, {[current.id]: current}),\n    {}\n  );\n\n  style.layers = style.layers.map(layer => {\n    layer = Object.assign({}, layer);\n\n    // Breaks style diffing :(\n    delete layer.interactive;\n\n    const layerRef = layerIndex[layer.ref];\n    // Style diffing doesn't work with refs so expand them out manually before diffing.\n    if (layerRef) {\n      delete layer.ref;\n      if (layerRef.type !== undefined) {\n        layer.type = layerRef.type;\n      }\n      if (layerRef.source !== undefined) {\n        layer.source = layerRef.source;\n      }\n      if (layerRef['source-layer'] !== undefined) {\n        layer['source-layer'] = layerRef['source-layer'];\n      }\n      if (layerRef.minzoom !== undefined) {\n        layer.minzoom = layerRef.minzoom;\n      }\n      if (layerRef.maxzoom !== undefined) {\n        layer.maxzoom = layerRef.maxzoom;\n      }\n      if (layerRef.filter !== undefined) {\n        layer.filter = layerRef.filter;\n      }\n      if (layerRef.layout !== undefined) {\n        layer.layout = layer.layout || {};\n        layer.layout = Object.assign({}, layer.layout, layerRef.layout);\n      }\n    }\n    return layer;\n  });\n\n  return style;\n}\n"],"file":"style-utils.js"}